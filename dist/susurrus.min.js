!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).Susurrus={})}(this,(function(t){"use strict";function e(t,e,r){return function(t,e,r){const i=t.createProgram();if(null===i)throw new Error("Something went wrong; could not create WebGLProgram.");if(t.attachShader(i,e),t.attachShader(i,r),t.linkProgram(i),!t.getProgramParameter(i,t.LINK_STATUS))throw new Error("An error occurred while initializing the shader program: "+t.getProgramInfoLog(i));return i}(t,s(t,t.VERTEX_SHADER,e),s(t,t.FRAGMENT_SHADER,r))}function r(t,e,r,i){const s=t.createBuffer();if(null===s)throw new Error("Something went wrong; could not create WebGLBuffer.");return t.bindBuffer(e,s),t.bufferData(e,r,i),s}function i(t,e,r,i){t.bindBuffer(e,r),t.bufferSubData(e,0,i)}function s(t,e,r){const i=t.createShader(e);if(null===i)throw new TypeError(`'${e}' is not a valid WebGL shader type.`);if(t.shaderSource(i,r),t.compileShader(i),!t.getShaderParameter(i,t.COMPILE_STATUS)){const e=new Error("An error occurred will compiling the shader: "+t.getShaderInfoLog(i));throw t.deleteShader(i),e}return i}function n(t,e,r){let i=!0;switch(e.toLowerCase()){case"array":i=Array.isArray(t);break;default:i=typeof t===e}return o(i,r,`Expected value to be a(n) '${e}'.`)}function a(t,e,r){return o(t instanceof e,r,`Expected value to be an instance of '${e.name}'.`)}function o(t,e,r){const i=()=>{throw new TypeError(r)};if(void 0!==e){if("object"==typeof e){if(void 0!==e.throwError&&"boolean"==typeof e.throwError&&!e.throwError)return t;if(!t){if(void 0!==e.errorMessage){if("string"==typeof e.errorMessage&&e.errorMessage.length>0)throw new TypeError(e.errorMessage);i()}if(void 0!==e.addendum){if("string"==typeof e.addendum&&e.addendum.length>0)throw new TypeError(`${r} ${e.addendum}`);i()}}}}else t||i()}var h,c,l,u,f=function(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r},d=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};class w{constructor(t,e){switch(h.set(this,void 0),c.set(this,void 0),l.set(this,void 0),u.set(this,void 0),f(this,h,0),f(this,c,0),f(this,l,0),f(this,u,1),typeof t){case"number":f(this,h,this.validateValue(((16711680&t)>>16)/255)),f(this,c,this.validateValue(((65280&t)>>8)/255)),f(this,l,this.validateValue((255&t)/255));break;case"string":{const e=parseInt(t,16);f(this,h,this.validateValue(((16711680&e)>>16)/255)),f(this,c,this.validateValue(((65280&e)>>8)/255)),f(this,l,this.validateValue((255&e)/255));break}}void 0!==e&&this.multiply(this.validateValue(e))}get r(){return d(this,h)}set r(t){f(this,h,this.validateValue(t))}get g(){return d(this,c)}set g(t){f(this,c,this.validateValue(t))}get b(){return d(this,l)}set b(t){f(this,l,this.validateValue(t))}get a(){return d(this,u)}set a(t){f(this,u,this.validateValue(t))}fromRGB(t,e,r,i){return f(this,h,this.validateValue(t/255)),f(this,c,this.validateValue(e/255)),f(this,l,this.validateValue(r/255)),void 0!==i&&this.multiply(this.validateValue(i)),this}multiply(t){f(this,h,this.validateValue(d(this,h)*t)),f(this,c,this.validateValue(d(this,c)*t)),f(this,l,this.validateValue(d(this,l)*t)),f(this,u,this.validateValue(d(this,u)*t))}toArray(){return[d(this,h),d(this,c),d(this,l),d(this,u)]}toString(){const t=Math.floor(255*d(this,h)),e=Math.floor(255*d(this,c)),r=Math.floor(255*d(this,l));let i=t.toString(16);1===i.length&&(i="0"+i);let s=e.toString(16);1===s.length&&(s="0"+s);let n=r.toString(16);return 1===n.length&&(n="0"+n),`(${t} ${e} ${r}) ${d(this,u).toFixed(4)}, 0x${i}${s}${n}`}validateValue(t){return t<1/255?0:t>1?1:Math.floor(t/(1/255))*(1/255)}}h=new WeakMap,c=new WeakMap,l=new WeakMap,u=new WeakMap;const p={VERTEX:0,INDEX:1};Object.freeze(p);var g,m=function(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r},y=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};class b{constructor(t,e,r){g.set(this,void 0),this.length=e,this.type=r,m(this,g,t),this.data=null,this.buffer=null,Object.defineProperty(this,"length",{writable:!1}),Object.defineProperty(this,"type",{writable:!1})}setData(t){if(null===this.data||null==this.buffer)throw new Error;if(t.length!=this.length)throw new TypeError(`Expected an array with ${this.length} element(s). Received an array with ${t.length} element(s) instead.`);switch(this.data.set(t),this.type){case p.VERTEX:!function(t,e,r){i(t,t.ARRAY_BUFFER,e,r)}(y(this,g).gl,this.buffer,this.data);break;case p.INDEX:!function(t,e,r){i(t,t.ELEMENT_ARRAY_BUFFER,e,r)}(y(this,g).gl,this.buffer,this.data);break;default:throw new TypeError(`'${this.type}' is an invalid BufferType.`)}}}g=new WeakMap;class v extends b{constructor(t,e,i,s,n){super(t,i,p.VERTEX),this.attributeSchema=e,this.vertexUsage=s,this.instanceFrequency=n||0,this.data=new Float32Array(this.length),this.buffer=function(t,e,i){let s=e;switch(i){case t.DYNAMIC_DRAW:s=4*e}return r(t,t.ARRAY_BUFFER,s,i)}(t.gl,this.data.byteLength,this.vertexUsage),Object.defineProperty(this,"attributeSchema",{writable:!1}),Object.defineProperty(this,"vertexUsage",{writable:!1}),Object.defineProperty(this,"instanceFrequency",{writable:!1})}}var E,T=function(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r},A=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};class x{constructor(t){E.set(this,void 0),this.gl=t,this.extensions={ANGLE_instanced_arrays:this.gl.getExtension("ANGLE_instanced_arrays")},T(this,E,null),function(t){t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA)}(this.gl),Object.defineProperty(this,"gl",{writable:!1}),Object.defineProperty(this,"extensions",{writable:!1})}clear(t){var e,r,i,s,n;a(t,w),e=this.gl,r=t.r,i=t.g,s=t.b,n=t.a,e.clearColor(r,i,s,n),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)}begin(t){T(this,E,t.program),this.gl.useProgram(A(this,E))}setVertexBuffer(t){if(null===A(this,E))throw new Error("'begin(effect)' must be called before setting a VertexBuffer.");this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t.buffer);for(let e of t.attributeSchema.elements){const r=this.gl.getAttribLocation(A(this,E),e.name);if(r<0)throw new Error(`The current program does not have a(n) '${e.name}' attribute.`);this.gl.enableVertexAttribArray(r),this.gl.vertexAttribPointer(r,e.size,e.type,!1,e.stride,e.offset),t.instanceFrequency>0&&this.extensions.ANGLE_instanced_arrays.vertexAttribDivisorANGLE(r,t.instanceFrequency)}}setVertexBuffers(t){for(let e of t)this.setVertexBuffer(e)}setIndexBuffer(t){this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,t.buffer)}setUniform(t,e){if(null===A(this,E))throw new Error("'begin(effect)' must be called before setting a uniform.");const r=this.gl.getUniformLocation(A(this,E),t);this.gl.uniformMatrix4fv(r,!1,e)}drawArrays(t,e,r){this.gl.drawArrays(t,e,r)}drawElements(t,e,r){this.gl.drawElements(t,3*e,this.gl.UNSIGNED_SHORT,r)}drawInstancedElements(t,e,r,i){this.extensions.ANGLE_instanced_arrays.drawElementsInstancedANGLE(t,3*e,this.gl.UNSIGNED_SHORT,r,i)}deleteBuffer(t){if(null===A(this,E))throw new Error("'begin(effect)' must be called before deleting a Buffer.");if(a(t,v,{throwError:!1})){const e=t;for(let t of e.attributeSchema.elements){const e=this.gl.getAttribLocation(A(this,E),t.name);if(e<0)throw new Error(`The current program does not have a(n) '${t.name}' attribute.`);this.gl.disableVertexAttribArray(e)}}this.gl.deleteBuffer(t.buffer)}end(){T(this,E,null)}}E=new WeakMap;var _,S=function(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r},O=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};_=new WeakMap;class B{constructor(t,e,r){this.name=t,this.size=e,this.type=r,this.stride=-1,this.offset=-1,Object.defineProperty(this,"name",{writable:!1}),Object.defineProperty(this,"size",{writable:!1}),Object.defineProperty(this,"type",{writable:!1})}}const R={BYTE:5120,SHORT:5122,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,FIXED:void 0,FLOAT:5126};Object.freeze(R);const L={BYTE:1,SHORT:2,UNSIGNED_BYTE:1,UNSIGNED_SHORT:2,FIXED:void 0,FLOAT:4};Object.freeze(L);class P{constructor(t){this.elements=t;const e=function(t){let e=0,r=0,i=[];for(let s of t)switch(e+=s.size,i.push(r),s.type){case R.FLOAT:r+=L.FLOAT*s.size;break;default:throw new TypeError("Unsupported attribute type.")}for(let e=0;e<t.length;e++)t[e].stride=r,t[e].offset=i[e];return{size:e,stride:r}}(this.elements);this.size=e.size,this.stride=e.stride,Object.defineProperty(this,"elements",{writable:!1}),Object.defineProperty(this,"size",{writable:!1}),Object.defineProperty(this,"stride",{writable:!1})}}const M={vertex:"\n        uniform mat4 worldViewProjection;\n\n        attribute vec3 a_position;\n        attribute vec3 a_translation;\n        attribute vec3 a_scale;\n        attribute vec3 a_rotationOffset;\n        attribute float a_rotation;\n        attribute vec4 a_color;\n\n        varying lowp vec4 v_color;\n\n        mat4 createTranslation(vec3 translation) {\n            return mat4(\n                1, 0, 0, 0,\n                0, 1, 0, 0,\n                0, 0, 1, 0,\n                translation.x, translation.y, translation.z, 1\n            );\n        }\n\n        mat4 createScale(vec3 scale) {\n            return mat4(\n                scale.x, 0, 0, 0,\n                0, scale.y, 0, 0,\n                0, 0, scale.z, 0,\n                0, 0, 0, 1\n            );\n        }\n\n        mat4 createRotationZ(float theta) {\n            return mat4(\n                cos(theta), -sin(theta), 0, 0,\n                sin(theta), cos(theta), 0, 0,\n                0, 0, 1, 0,\n                0, 0, 0, 1\n            );\n        }\n\n        void main() {\n            mat4 transform = createTranslation(a_rotationOffset) * createRotationZ(a_rotation) * createTranslation(-a_rotationOffset + a_translation) * createScale(a_scale);\n            gl_Position = transform * vec4(a_position, 1) * worldViewProjection;\n            v_color = a_color;\n        }\n    ",fragment:"\n        varying lowp vec4 v_color;\n\n        void main() {\n            gl_FragColor = v_color;\n        }\n    "};class z{constructor(t,r,i){this.program=e(t.gl,r,i),Object.defineProperty(this,"program",{writable:!1})}}const I={Black:new w(0),White:new w(16777215),Red:new w(16711680),Green:new w(65280),Blue:new w(255),SkyBlue:new w(2731519)};Object.freeze(I);const N={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};Object.freeze(N);class V extends b{constructor(t,e){var i,s;super(t,e,p.INDEX),this.data=new Int16Array(this.length),this.buffer=(i=t.gl,s=this.data.byteLength,r(i,i.ELEMENT_ARRAY_BUFFER,s,i.STATIC_DRAW))}}const F={STREAM:35040,STATIC:35044,DYNAMIC:35048};Object.freeze(F);class j{constructor(t,e,r){this.x=t,this.y=e,this.z=r}multiply(t){this.x*=t,this.y*=t,this.z*=t}divide(t){this.x/=t,this.y/=t,this.z/=t}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}normalize(){const t=this.length();t>0&&this.divide(t)}toArray(){return[this.x,this.y,this.z]}static dot(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}static cross(t,e){const r=t.y*e.z-e.y*t.z,i=-(t.x*e.z-e.x*t.z),s=t.x*e.y-e.x*t.y;return new j(r,i,s)}static subtract(t,e){const r=t.x-e.x,i=t.y-e.y,s=t.z-e.z;return new j(r,i,s)}}var D,k,U,G,W,C,$=function(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r},Y=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};const H=new P([new B("a_translation",3,R.FLOAT),new B("a_scale",3,R.FLOAT),new B("a_rotationOffset",3,R.FLOAT),new B("a_rotation",1,R.FLOAT),new B("a_color",4,R.FLOAT)]);D=new WeakMap,k=new WeakMap,U=new WeakMap,G=new WeakMap,W=new WeakMap,C=new WeakMap;const X=new P([new B("a_position",3,R.FLOAT)]);var q,Z,K,J=function(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r},Q=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};class tt{constructor(t,e,r){q.set(this,void 0),Z.set(this,void 0),K.set(this,void 0),J(this,q,t),J(this,Z,e),J(this,K,new Array(Q(this,q)*Q(this,Z)).fill(0)),void 0!==r&&this.setData(r)}get rows(){return Q(this,q)}get columns(){return Q(this,Z)}get data(){return Q(this,K)}get(t,e){return this.data[this.columns*e+t]}setData(t){if(n(t,"array"),t.length!==this.rows*this.columns)throw new TypeError("The data does not match the dimensions of the matrix.");J(this,K,t.slice(0))}set(t,e,r){n(r,"number"),Q(this,K)[this.columns*e+t]=r}transpose(){const t=new Array(this.rows*this.columns).fill(0),e=this.columns,r=this.rows;for(let i=0;i<e;i++)for(let e=0;e<r;e++)t[r*i+e]=this.data[this.columns*e+i];J(this,K,t),J(this,q,e),J(this,Z,r)}add(t){if(n(t,"number",{throwError:!1})){const e=t;for(let t=0;t<this.rows*this.columns;t++)Q(this,K)[t]+=e;return this}a(t,tt);const e=t;if(this.rows!==e.rows||this.columns!==e.columns)throw new TypeError("Both matrices are not the same size; cannot perform operation.");for(let t=0;t<this.rows*this.columns;t++)Q(this,K)[t]+=e.data[t];return this}subtract(t){if(n(t,"number",{throwError:!1})){const e=t;for(let t=0;t<this.rows*this.columns;t++)Q(this,K)[t]-=e;return this}a(t,tt);const e=t;if(this.rows!==e.rows||this.columns!==e.columns)throw new TypeError("Both matrices are not the same size; cannot perform operation.");for(let t=0;t<this.rows*this.columns;t++)Q(this,K)[t]-=e.data[t];return this}multiply(t){if(n(t,"number",{throwError:!1})){const e=t;for(let t=0;t<this.rows*this.columns;t++)Q(this,K)[t]*=e;return this}a(t,tt);const e=t;if(this.columns!==e.rows)throw new TypeError(`The matrix provided must have ${this.columns} rows; cannot multiply matrices.`);const r=new tt(this.rows,e.columns);for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)for(let s=0;s<e.columns;s++)r.set(s,t,r.get(s,t)+this.get(i,t)*e.get(s,i));return J(this,K,r.data),this}divide(t){n(t,"number");const e=1/t;for(let t=0;t<this.rows*this.columns;t++)Q(this,K)[t]*=e;return this}toString(){let t="";for(let e=0;e<Q(this,K).length;e+=this.columns){t+="( "+Q(this,K)[e];for(let r=1;r<this.columns;r++)t+=" "+Q(this,K)[e+r];t+=" )",e!==Q(this,K).length-this.columns&&(t+=" ")}return t}}q=new WeakMap,Z=new WeakMap,K=new WeakMap;class et extends tt{constructor(t){super(4,4,t)}static identity(){return new et([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}static createRotationZ(t){const e=et.identity();return e.set(0,0,Math.cos(t)),e.set(1,0,Math.sin(t)),e.set(0,1,-Math.sin(t)),e.set(1,1,Math.cos(t)),e}static createTranslation(t,e,r){const i=et.identity();return t&&i.set(0,3,t),e&&i.set(1,3,e),r&&i.set(2,3,r),i}static createOrthographic(t,e,r,i){const s=et.identity();return s.set(0,0,2/t),s.set(1,1,2/e),s.set(2,2,1/(r-i)),s.set(2,3,r/(r-i)),s}static createLookAt(t,e,r){const i=j.subtract(t,e);i.normalize();const s=j.cross(r,i);s.normalize();const n=j.cross(i,s),a=et.identity();return a.set(0,0,s.x),a.set(1,0,n.x),a.set(2,0,i.x),a.set(0,1,s.y),a.set(1,1,n.y),a.set(2,1,i.y),a.set(0,2,s.z),a.set(1,2,n.z),a.set(2,2,i.z),a.set(0,3,-j.dot(s,t)),a.set(1,3,-j.dot(n,t)),a.set(2,3,-j.dot(i,t)),a}}t.AttributeElement=B,t.AttributeSchema=P,t.AttributeType=R,t.BasicEffect=class extends z{constructor(t){super(t,M.vertex,M.fragment)}},t.Camera=class{constructor(){this.world=et.createTranslation(0,0,0),this.view=et.createLookAt(new j(0,0,1),new j(0,0,0),new j(0,1,0)),this.projection=et.createOrthographic(4,4,0,16),this.worldViewProjection=this.view.multiply(this.world).multiply(this.projection)}},t.Color=w,t.Colors=I,t.DrawMode=N,t.DynamicMatrix=tt,t.Effect=z,t.IndexBuffer=V,t.Matrix=et,t.Polygon=class{constructor(t,e){D.set(this,void 0),k.set(this,void 0),U.set(this,void 0),G.set(this,void 0),W.set(this,void 0),C.set(this,void 0),this.geometry=e,this.attributeSchema=H,$(this,D,new j(0,0,0)),$(this,k,new j(1,1,1)),$(this,U,new j(0,0,0)),$(this,G,0),$(this,W,new w(16777215)),this.transformBuffer=new v(t,this.attributeSchema,1*this.attributeSchema.size,F.DYNAMIC,1),this.updateBuffer(),$(this,C,!1),Object.defineProperty(this,"geometry",{writable:!1}),Object.defineProperty(this,"attributeSchema",{writable:!1}),Object.defineProperty(this,"transformBuffer",{writable:!1})}get position(){return Y(this,D)}set position(t){t!==Y(this,D)&&($(this,D,t),$(this,C,!0))}get scale(){return Y(this,k)}set scale(t){t!==Y(this,k)&&($(this,k,t),$(this,C,!0))}get rotationOffset(){return Y(this,U)}set rotationOffset(t){t!==Y(this,U)&&($(this,U,t),$(this,C,!0))}get rotation(){return Y(this,G)}set rotation(t){t!==Y(this,G)&&($(this,G,t),$(this,C,!0))}get color(){return Y(this,W)}set color(t){t!==Y(this,W)&&($(this,W,t),$(this,C,!0))}applyChanges(){$(this,C,!1),this.updateBuffer()}draw(t,e,r){Y(this,C)&&this.applyChanges(),t.begin(e),t.setVertexBuffers([this.geometry.vertexBuffer,this.transformBuffer]),t.setIndexBuffer(this.geometry.indexBuffer),t.setUniform("worldViewProjection",r.worldViewProjection.data),t.drawElements(N.TRIANGLES,this.geometry.totalTriangles,0),t.end()}updateBuffer(){let t=[];t=t.concat(Y(this,D).toArray()),t=t.concat(Y(this,k).toArray()),t=t.concat(Y(this,U).toArray()),t=t.concat(Y(this,G)),t=t.concat(Y(this,W).toArray()),this.transformBuffer.setData(t)}},t.PolygonData=class{constructor(t,e,r){this.vertexBuffer=new v(t,X,e.length,F.STATIC),this.indexBuffer=new V(t,r.length),this.totalVertices=e.length/3,this.totalTriangles=r.length/3,this.vertexBuffer.setData(e),this.indexBuffer.setData(r)}},t.Sketch=class{constructor(t){_.set(this,void 0);const e=document.getElementById(t);if(null===e)throw new TypeError(`Could not find an element with an id of '${t}'.`);this.parent=e,this.canvas=document.createElement("canvas"),this.parent.appendChild(this.canvas),this.canvas.id=t+"-canvas",this.canvas.width=400,this.canvas.height=400,this.graphics=new x(function(t){const e=t.getContext("webgl");if(null===e)throw new Error("WebGL is not supported on this device.");return e}(this.canvas)),S(this,_,!1),this.loop=!0,Object.defineProperty(this,"parent",{writable:!1}),Object.defineProperty(this,"canvas",{writable:!1}),Object.defineProperty(this,"graphics",{writable:!1})}run(){O(this,_)||(this.initialize(),S(this,_,!0)),this.update(),this.draw(),this.loop&&window.requestAnimationFrame(this.run.bind(this))}initialize(){}update(){}draw(){}},t.Vector2=j,t.Vector3=j,t.Vector4=j,t.VertexBuffer=v,t.VertexUsage=F,Object.defineProperty(t,"__esModule",{value:!0})}));
