"use strict";function t(t,e){return{x:t.x1+e*(t.x2-t.x1),y:t.y1+e*(t.y2-t.y1)}}Object.defineProperty(exports,"__esModule",{value:!0});class e{constructor(t,e,s,i){this.x1=t,this.y1=e,this.x2=s,this.y2=i}getIntersectionInformation(e){const s=e.x1,i=e.y1,r=e.x2,n=e.y2,a=(this.x1-this.x2)*(i-n)-(this.y1-this.y2)*(s-r);if(0===a)return null;let h=(this.x1-s)*(i-n)-(this.y1-i)*(s-r);const o=h/a;h=(this.x1-this.x2)*(this.y1-i)-(this.y1-this.y2)*(this.x1-s);const l=-h/a;return{t:o,u:l,intersected:0<=o&&o<=1&&0<=l&&l<=1,convergence:t(this,o)}}intersects(t){const e=this.getIntersectionInformation(t);return null!==e&&e.intersected}}function s(t,e,s,i,r){return i+(r-i)*(t-e)/(s-e)}function i(t,e,s){return t+s*(e-t)}function r(t,e,s){return(1-s)*t+s*e}var n=Object.freeze({__proto__:null,remapRange:s,lerp:i,lerpPrecise:r,log:function(t,e){switch(e){case 2:return Math.log(t)/Math.LN2;case 10:return Math.log(t)/Math.LN10;default:return Math.log(t)/Math.log(e)}}});class a{constructor(t,e){this.x=t,this.y=e}static get ZERO(){return new a(0,0)}static get ONE(){return new a(1,1)}static get UNIT_X(){return new a(1,0)}static get UNIT_Y(){return new a(0,1)}length(){return Math.sqrt(this.lengthSquared())}lengthSquared(){return this.x**2+this.y**2}normalize(){const t=1/this.length();return this.x*=t,this.y*=t,this}copy(t){this.x=t.x,this.y=t.y}clone(){return new a(this.x,this.y)}toArray(){return[this.x,this.y]}toString(){return`(${this.x}, ${this.y})`}static distanceSquared(t,e){return(t.x-e.x)**2+(t.y-e.y)**2}static distance(t,e){return Math.sqrt(a.distanceSquared(t,e))}static dot(t,e){return t.x*e.x+t.y*e.y}static lerp(t,e,s){const r=i(t.x,e.x,s),n=i(t.y,e.y,s);return new a(r,n)}static lerpPrecise(t,e,s){const i=r(t.x,e.x,s),n=r(t.y,e.y,s);return new a(i,n)}static polarToCartesian(t,e){return new a(t*Math.cos(e),t*Math.sin(e))}static fromAngle(t){return a.polarToCartesian(1,t)}static random(){return a.fromAngle(Math.random()*Math.PI*2)}static add(t,e){const s=t.x+e.x,i=t.y+e.y;return new a(s,i)}static subtract(t,e){const s=t.x-e.x,i=t.y-e.y;return new a(s,i)}static multiply(t,e){const s=t.x*e.x,i=t.y*e.y;return new a(s,i)}static divide(t,e){const s=t.x/e.x,i=t.y/e.y;return new a(s,i)}static addScalar(t,e){const s=t.x+e,i=t.y+e;return new a(s,i)}static subtractScalar(t,e){const s=t.x-e,i=t.y-e;return new a(s,i)}static multiplyScalar(t,e){const s=t.x*e,i=t.y*e;return new a(s,i)}static divideScalar(t,e){const s=t.x/e,i=t.y/e;return new a(s,i)}static transform(t,e){const s=t.x*e.data[0]+t.y*e.data[4]+e.data[12],i=t.x*e.data[1]+t.y*e.data[5]+e.data[13];return new a(s,i)}}class h{constructor(t,e,s,i){this.x=t,this.y=e,this.width=s,this.height=i}get left(){return this.x}get top(){return this.y}get right(){return this.x+this.width}get bottom(){return this.y-this.height}intersects(t){return this.left<t.right&&this.right>t.left&&this.top>t.bottom&&this.bottom<t.top}completelyWithin(t){return this.left>=t.left&&this.right<=t.right&&this.bottom>=t.bottom&&this.top<=t.top}getResolution(t){const s=[new a(this.left,this.top),new a(this.right,this.top),new a(this.right,this.bottom),new a(this.left,this.bottom)],i=[new e(s[0].x,s[0].y,s[1].x,s[1].y),new e(s[1].x,s[1].y,s[2].x,s[2].y)],r=[new a(t.left,t.top),new a(t.right,t.top),new a(t.right,t.bottom),new a(t.left,t.bottom)];return o({vertices:s,edges:i},{vertices:r,edges:[new e(r[0].x,r[0].y,r[1].x,r[1].y),new e(r[1].x,r[1].y,r[2].x,r[2].y)]})}}function o(t,e){const s=l(t.vertices),i=l(e.vertices);if(!s.intersects(i))return new a(0,0);const r=c(t,e),n=c(e,t);if(null===r||null===n)return new a(0,0);const h=r.overlap<n.overlap?r:n,o=new a(-(h.edge.y2-h.edge.y1),h.edge.x2-h.edge.x1),d=o.length(),u=Math.acos(a.dot(o,new a(1,0))/d),p=Math.round(d*Math.cos(u)),w=Math.round(d*Math.sin(u)),f=s.left>i.left?1:-1,g=s.bottom>i.bottom?1:-1,y=0===p?0:h.overlap/p*f,m=0===w?0:h.overlap/w*g;return new a(y,m)}function l(t){let e=t[0].x,s=e,i=t[0].y,r=i;for(let n=1;n<t.length;n++)e=Math.min(e,t[n].x),s=Math.max(s,t[n].x),i=Math.min(i,t[n].y),r=Math.max(r,t[n].y);return new h(e,r,s-e,r-i)}function c(t,s){let i=new e(0,0,0,0),r=Number.MAX_SAFE_INTEGER;for(let e=0;e<t.edges.length;e++){const n=new a(-(t.edges[e].y2-t.edges[e].y1),t.edges[e].x2-t.edges[e].x1);let h=a.dot(t.vertices[0],n),o=h;for(let e=1;e<t.vertices.length;e++){const s=a.dot(t.vertices[e],n);h=Math.min(h,s),o=Math.max(o,s)}let l=a.dot(s.vertices[0],n),c=l;for(let t=1;t<s.vertices.length;t++){const e=a.dot(s.vertices[t],n);l=Math.min(l,e),c=Math.max(c,e)}const d=Math.min(o,c)-Math.max(h,l);if(d<r&&(r=d,i=t.edges[e]),c<h||o<l)return null}return{edge:i,overlap:r}}var d,u,p,w=Object.freeze({__proto__:null,getResolution:o}),f=function(t,e,s){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,s),s},g=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};class y{constructor(t,e,s){d.set(this,void 0),u.set(this,void 0),p.set(this,void 0),f(this,d,t),f(this,u,e),f(this,p,new Array(g(this,d)*g(this,u)).fill(0)),void 0!==s&&this.setData(s)}get rows(){return g(this,d)}get columns(){return g(this,u)}get data(){return g(this,p)}get(t,e){return this.data[this.columns*e+t]}setData(t){if(t.length!==this.rows*this.columns)throw new TypeError("The given data does not match the dimensions of the matrix.");f(this,p,t.slice(0))}set(t,e,s){g(this,p)[this.columns*e+t]=s}transpose(){const t=new Array(this.rows*this.columns).fill(0),e=this.columns,s=this.rows;for(let i=0;i<e;i++)for(let e=0;e<s;e++)t[s*i+e]=this.data[this.columns*e+i];f(this,p,t)}toString(){let t="";for(let e=0;e<g(this,p).length;e+=this.columns){t+="("+g(this,p)[e];for(let s=1;s<this.columns;s++)t+=" "+g(this,p)[e+s];t+=")",e!==g(this,p).length-this.columns&&(t+=" ")}return t}static add(t,e){if(t.rows!==e.rows||t.columns!==e.columns)throw new TypeError("Both matrices are not the same size; cannot perform operation.");const s=t.data.slice(0);for(let i=0;i<t.data.length;i++)s[i]+=e.data[i];return new y(t.rows,t.columns,s)}static subtract(t,e){if(t.rows!==e.rows||t.columns!==e.columns)throw new TypeError("Both matrices are not the same size; cannot perform operation.");const s=t.data.slice(0);for(let i=0;i<t.rows*t.columns;i++)s[i]-=e.data[i];return new y(t.rows,e.rows,s)}static multiply(t,e){if(t.columns!==e.rows)throw new TypeError(`Matrix b must have ${t.columns} rows; cannot multiply matrices.`);const s=new y(t.rows,e.columns);for(let i=0;i<t.rows;i++)for(let r=0;r<e.columns;r++){let n=0;for(let s=0;s<t.columns;s++)n+=t.get(s,i)*e.get(r,s);s.set(r,i,n)}return s}static addScalar(t,e){const s=t.data.slice(0);for(let i=0;i<t.data.length;i++)s[i]+=e;return new y(t.rows,t.columns,s)}static subtractScalar(t,e){const s=t.data.slice(0);for(let i=0;i<t.data.length;i++)s[i]-=e;return new y(t.rows,t.columns,s)}static multiplyScalar(t,e){const s=t.data.slice(0);for(let i=0;i<t.data.length;i++)s[i]*=e;return new y(t.rows,t.columns,s)}static divideScalar(t,e){const s=1/e;return y.multiplyScalar(t,s)}}d=new WeakMap,u=new WeakMap,p=new WeakMap;class m{constructor(t,e,s){this.x=t,this.y=e,this.z=s}static get ZERO(){return new m(0,0,0)}static get ONE(){return new m(1,1,1)}static get UNIT_X(){return new m(1,0,0)}static get UNIT_Y(){return new m(0,1,0)}static get UNIT_Z(){return new m(0,0,1)}static get LEFT(){return new m(-1,0,0)}static get UP(){return new m(0,1,0)}static get RIGHT(){return new m(1,0,0)}static get DOWN(){return new m(0,-1,0)}static get FORWARD(){return new m(0,0,-1)}static get BACKWARD(){return new m(0,0,1)}length(){return Math.sqrt(this.lengthSquared())}lengthSquared(){return this.x**2+this.y**2+this.z**2}normalize(){const t=1/this.length();return this.x*=t,this.y*=t,this.z*=t,this}copy(t){this.x=t.x,this.y=t.y,this.z=t.z}clone(){return new m(this.x,this.y,this.z)}toArray(){return[this.x,this.y,this.z]}toString(){return`(${this.x}, ${this.y}, ${this.z})`}static distanceSquared(t,e){return(t.x-e.x)**2+(t.y-e.y)**2+(t.z-e.z)**2}static distance(t,e){return Math.sqrt(m.distanceSquared(t,e))}static dot(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}static lerp(t,e,s){const r=i(t.x,e.x,s),n=i(t.y,e.y,s),a=i(t.z,e.z,s);return new m(r,n,a)}static lerpPrecise(t,e,s){const i=r(t.x,e.x,s),n=r(t.y,e.y,s),a=r(t.z,e.z,s);return new m(i,n,a)}static sphericalToCartesian(t,e,s){return new m(t*Math.sin(s)*Math.cos(e),t*Math.sin(s)*Math.sin(e),t*Math.cos(s))}static cross(t,e){const s=t.y*e.z-e.y*t.z,i=t.z*e.x-e.z*t.x,r=t.x*e.y-e.x*t.y;return new m(s,i,r)}static add(t,e){const s=t.x+e.x,i=t.y+e.y,r=t.z+e.z;return new m(s,i,r)}static subtract(t,e){const s=t.x-e.x,i=t.y-e.y,r=t.z-e.z;return new m(s,i,r)}static multiply(t,e){const s=t.x*e.x,i=t.y*e.y,r=t.z*e.z;return new m(s,i,r)}static divide(t,e){const s=t.x/e.x,i=t.y/e.y,r=t.z/e.z;return new m(s,i,r)}static addScalar(t,e){const s=t.x+e,i=t.y+e,r=t.z+e;return new m(s,i,r)}static subtractScalar(t,e){const s=t.x-e,i=t.y-e,r=t.z-e;return new m(s,i,r)}static multiplyScalar(t,e){const s=t.x*e,i=t.y*e,r=t.z*e;return new m(s,i,r)}static divideScalar(t,e){const s=t.x/e,i=t.y/e,r=t.z/e;return new m(s,i,r)}static transform(t,e){const s=t.x*e.data[0]+t.y*e.data[4]+t.z*e.data[8]+e.data[12],i=t.x*e.data[1]+t.y*e.data[5]+t.z*e.data[9]+e.data[13],r=t.x*e.data[2]+t.y*e.data[6]+t.z*e.data[10]+e.data[14];return new m(s,i,r)}}var v,E,x,b=function(t,e,s){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,s),s},T=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};class M{constructor(t){v.set(this,void 0),E.set(this,void 0),x.set(this,void 0),b(this,v,4),b(this,E,4),b(this,x,new Array(T(this,v)*T(this,E)).fill(0)),void 0!==t&&this.setData(t)}get rows(){return T(this,v)}get columns(){return T(this,E)}get data(){return T(this,x)}static get IDENTITY(){return new M([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}setData(t){if(t.length!==T(this,v)*T(this,E))throw new TypeError("The given data does not match the dimensions of the matrix.");b(this,x,t.slice(0))}get(t,e){return T(this,x)[T(this,E)*e+t]}set(t,e,s){T(this,x)[T(this,E)*e+t]=s}transpose(){const t=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];t[0]=T(this,x)[0],t[1]=T(this,x)[4],t[2]=T(this,x)[8],t[3]=T(this,x)[12],t[4]=T(this,x)[1],t[5]=T(this,x)[5],t[6]=T(this,x)[9],t[7]=T(this,x)[13],t[8]=T(this,x)[2],t[9]=T(this,x)[6],t[10]=T(this,x)[10],t[11]=T(this,x)[14],t[12]=T(this,x)[3],t[13]=T(this,x)[7],t[14]=T(this,x)[11],t[15]=T(this,x)[15],b(this,x,t)}toString(){return`(${this.data[0]}, ${this.data[1]}, ${this.data[2]}, ${this.data[3]}) (${this.data[4]}, ${this.data[5]}, ${this.data[6]}, ${this.data[7]}) (${this.data[8]}, ${this.data[9]}, ${this.data[10]}, ${this.data[11]}) (${this.data[12]}, ${this.data[13]}, ${this.data[14]}, ${this.data[15]})`}static add(t,e){const s=t.data.slice(0);for(let t=0;t<s.length;t++)s[t]+=e.data[t];return new M(s)}static subtract(t,e){const s=t.data.slice(0);for(let t=0;t<s.length;t++)s[t]-=e.data[t];return new M(s)}static multiply(t,e){const s=new Array(16).fill(0);return s[0]=t.data[0]*e.data[0]+t.data[1]*e.data[4]+t.data[2]*e.data[8]+t.data[3]*e.data[12],s[1]=t.data[0]*e.data[1]+t.data[1]*e.data[5]+t.data[2]*e.data[9]+t.data[3]*e.data[13],s[2]=t.data[0]*e.data[2]+t.data[1]*e.data[6]+t.data[2]*e.data[10]+t.data[3]*e.data[14],s[3]=t.data[0]*e.data[3]+t.data[1]*e.data[7]+t.data[2]*e.data[11]+t.data[3]*e.data[15],s[4]=t.data[4]*e.data[0]+t.data[5]*e.data[4]+t.data[6]*e.data[8]+t.data[7]*e.data[12],s[5]=t.data[4]*e.data[1]+t.data[5]*e.data[5]+t.data[6]*e.data[9]+t.data[7]*e.data[13],s[6]=t.data[4]*e.data[2]+t.data[5]*e.data[6]+t.data[6]*e.data[10]+t.data[7]*e.data[14],s[7]=t.data[4]*e.data[3]+t.data[5]*e.data[7]+t.data[6]*e.data[11]+t.data[7]*e.data[15],s[8]=t.data[8]*e.data[0]+t.data[9]*e.data[4]+t.data[10]*e.data[8]+t.data[11]*e.data[12],s[9]=t.data[8]*e.data[1]+t.data[9]*e.data[5]+t.data[10]*e.data[9]+t.data[11]*e.data[13],s[10]=t.data[8]*e.data[2]+t.data[9]*e.data[6]+t.data[10]*e.data[10]+t.data[11]*e.data[14],s[11]=t.data[8]*e.data[3]+t.data[9]*e.data[7]+t.data[10]*e.data[11]+t.data[11]*e.data[15],s[12]=t.data[12]*e.data[0]+t.data[13]*e.data[4]+t.data[14]*e.data[8]+t.data[15]*e.data[12],s[13]=t.data[12]*e.data[1]+t.data[13]*e.data[5]+t.data[14]*e.data[9]+t.data[15]*e.data[13],s[14]=t.data[12]*e.data[2]+t.data[13]*e.data[6]+t.data[14]*e.data[10]+t.data[15]*e.data[14],s[15]=t.data[12]*e.data[3]+t.data[13]*e.data[7]+t.data[14]*e.data[11]+t.data[15]*e.data[15],new M(s)}static addScalar(t,e){const s=t.data.slice(0);for(let t=0;t<s.length;t++)s[t]+=e;return new M(s)}static subtractScalar(t,e){const s=t.data.slice(0);for(let t=0;t<s.length;t++)s[t]-=e;return new M(s)}static multiplyScalar(t,e){const s=t.data.slice(0);for(let t=0;t<s.length;t++)s[t]*=e;return new M(s)}static divideScalar(t,e){const s=1/e;return M.multiplyScalar(t,s)}static createRotationX(t){const e=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return e[5]=Math.cos(t),e[6]=Math.sin(t),e[9]=-Math.sin(t),e[10]=Math.cos(t),new M(e)}static createRotationY(t){const e=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return e[0]=Math.cos(t),e[2]=-Math.sin(t),e[8]=Math.sin(t),e[10]=Math.cos(t),new M(e)}static createRotationZ(t){const e=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return e[0]=Math.cos(t),e[1]=Math.sin(t),e[4]=-Math.sin(t),e[5]=Math.cos(t),new M(e)}static createTranslation(t,e,s){const i=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return i[12]=t,i[13]=e,i[14]=s,new M(i)}static createScale(t,e,s){const i=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return i[0]=t,i[5]=e,i[10]=s,new M(i)}static createOrthographic(t,e,s,i){const r=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],n=1/(i-s);return r[0]=2/t,r[5]=2/e,r[10]=-2*n,r[14]=-(i+s)*n,new M(r)}static createOrthographicOffCenter(t,e,s,i,r,n){const a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],h=1/(e-t),o=1/(i-s),l=1/(n-r);return a[0]=2*h,a[5]=2*o,a[10]=-2*l,a[12]=-(e+t)*h,a[13]=-(i+s)*o,a[14]=-(n+r)*l,a[15]=1,new M(a)}static createPerspective(t,e,s,i){const r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],n=1/(i-s);return r[0]=2*s/t,r[5]=2*s/e,r[10]=-(i+s)*n,r[11]=-1,r[14]=-2*i*s*n,new M(r)}static createPerspectiveOffCenter(t,e,s,i,r,n){const a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],h=1/(e-t),o=1/(i-s),l=1/(n-r);return a[0]=2*r*h,a[5]=2*r*o,a[8]=(e+t)*h,a[9]=(i+s)*o,a[10]=-(n+r)*l,a[11]=-1,a[14]=-2*n*r*l,new M(a)}static createLookAt(t,e,s){const i=m.subtract(t,e).normalize(),r=m.cross(s,i).normalize(),n=m.cross(i,r),a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return a[0]=r.x,a[1]=n.x,a[2]=i.x,a[4]=r.y,a[5]=n.y,a[6]=i.y,a[8]=r.z,a[9]=n.z,a[10]=i.z,a[12]=-m.dot(r,t),a[13]=-m.dot(n,t),a[14]=-m.dot(i,t),new M(a)}}v=new WeakMap,E=new WeakMap,x=new WeakMap;var _,k=function(t,e,s){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,s),s},A=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};function S(t){return function(){var e=t+=1831565813;return e=Math.imul(e^e>>>15,1|e),(((e^=e+Math.imul(e^e>>>7,61|e))^e>>>14)>>>0)/4294967296}}_=new WeakMap;var P,W,R,O,L,I,z,N,B,D,G,U,C,j=Object.freeze({__proto__:null,roll:function(t){return!(t<=0)&&(t>=1||Math.random()<=t)},gaussian:function(t,e){const s=1-Math.random(),i=1-Math.random();return t+e*(Math.sqrt(-2*Math.log(s))*Math.sin(2*Math.PI*i))}}),F=function(t,e,s){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,s),s},V=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};function X(t,e,s){const i=M.multiply;return i(i(t,e),s)}!function(t){t[t.None=0]="None",t[t.Orthographic=1]="Orthographic",t[t.Perspective=2]="Perspective"}(C||(C={}));P=new WeakMap,W=new WeakMap,R=new WeakMap,O=new WeakMap,L=new WeakMap,I=new WeakMap,z=new WeakMap,N=new WeakMap,B=new WeakMap,D=new WeakMap,G=new WeakMap,U=new WeakMap;class ${constructor(t,e,s){this.name=t,this.size=e,this.type=s,this.stride=-1,this.offset=-1,Object.defineProperty(this,"name",{writable:!1}),Object.defineProperty(this,"size",{writable:!1}),Object.defineProperty(this,"type",{writable:!1})}}const q={BYTE:5120,SHORT:5122,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,FIXED:void 0,FLOAT:5126};Object.freeze(q);const H={BYTE:1,SHORT:2,UNSIGNED_BYTE:1,UNSIGNED_SHORT:2,FIXED:void 0,FLOAT:4};Object.freeze(H);class Y{constructor(t){this.elements=t;const e=function(t){let e=0,s=0,i=[];for(let r of t)switch(e+=r.size,i.push(s),r.type){case q.FLOAT:s+=H.FLOAT*r.size;break;default:throw new TypeError("Unsupported attribute type.")}for(let e=0;e<t.length;e++)t[e].stride=s,t[e].offset=i[e];return{size:e,stride:s}}(this.elements);this.size=e.size,this.stride=e.stride,Object.defineProperty(this,"elements",{writable:!1}),Object.defineProperty(this,"size",{writable:!1}),Object.defineProperty(this,"stride",{writable:!1})}}function K(t,e,s){return function(t,e,s){const i=t.createProgram();if(null===i)throw new Error("Something went wrong; could not create WebGLProgram.");if(t.attachShader(i,e),t.attachShader(i,s),t.linkProgram(i),!t.getProgramParameter(i,t.LINK_STATUS))throw new Error("An error occurred while initializing the shader program: "+t.getProgramInfoLog(i));return i}(t,J(t,t.VERTEX_SHADER,e),J(t,t.FRAGMENT_SHADER,s))}function Z(t,e,s,i){const r=t.createBuffer();if(null===r)throw new Error("Something went wrong; could not create WebGLBuffer.");return t.bindBuffer(e,r),t.bufferData(e,s,i),r}function Q(t,e,s,i){t.bindBuffer(e,s),t.bufferSubData(e,0,i)}function J(t,e,s){const i=t.createShader(e);if(null===i)throw new TypeError(`'${e}' is not a valid WebGL shader type.`);if(t.shaderSource(i,s),t.compileShader(i),!t.getShaderParameter(i,t.COMPILE_STATUS)){const e=new Error("An error occurred will compiling the shader: "+t.getShaderInfoLog(i));throw t.deleteShader(i),e}return i}function tt(t){return 0==(t&t-1)}const et={VERTEX:0,INDEX:1};Object.freeze(et);var st,it=function(t,e,s){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,s),s},rt=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};class nt{constructor(t,e,s){st.set(this,void 0),this.length=e,this.type=s,it(this,st,t),this.data=null,this.buffer=null,Object.defineProperty(this,"length",{writable:!1}),Object.defineProperty(this,"type",{writable:!1})}setData(t){if(null===this.data||null===this.buffer)throw new Error("This buffer was not initialized correctly. Make sure the 'data' and 'buffer' properties are set..");if(null!=t){if(t.length>this.length)throw new TypeError(`Expected an array with ${this.length} element(s) or less.`);switch(this.data.set(t),this.type){case et.VERTEX:!function(t,e,s){Q(t,t.ARRAY_BUFFER,e,s)}(rt(this,st).gl,this.buffer,this.data);break;case et.INDEX:!function(t,e,s){Q(t,t.ELEMENT_ARRAY_BUFFER,e,s)}(rt(this,st).gl,this.buffer,this.data);break;default:throw new TypeError(`'${this.type}' is an invalid BufferType.`)}}}}st=new WeakMap;var at,ht,ot,lt,ct=function(t,e,s){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,s),s},dt=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};class ut{constructor(t,e){switch(at.set(this,void 0),ht.set(this,void 0),ot.set(this,void 0),lt.set(this,void 0),ct(this,at,0),ct(this,ht,0),ct(this,ot,0),ct(this,lt,1),typeof t){case"number":ct(this,at,this.validateValue(((16711680&t)>>16)/255)),ct(this,ht,this.validateValue(((65280&t)>>8)/255)),ct(this,ot,this.validateValue((255&t)/255));break;case"string":{let e=t.toLowerCase().trim();if(e="#"==e.substring(0,1)?e.substring(1):e,!/^[\da-f]{6}$/.test(e))throw new TypeError("The given string could not be parsed as a hexadecimal value.");const s=parseInt(e,16);ct(this,at,this.validateValue(((16711680&s)>>16)/255)),ct(this,ht,this.validateValue(((65280&s)>>8)/255)),ct(this,ot,this.validateValue((255&s)/255));break}}void 0!==e&&this.multiply(this.validateValue(e))}get r(){return dt(this,at)}set r(t){ct(this,at,this.validateValue(t))}get g(){return dt(this,ht)}set g(t){ct(this,ht,this.validateValue(t))}get b(){return dt(this,ot)}set b(t){ct(this,ot,this.validateValue(t))}get a(){return dt(this,lt)}set a(t){ct(this,lt,this.validateValue(t))}fromRGB(t,e,s,i){return ct(this,at,this.validateValue(t/255)),ct(this,ht,this.validateValue(e/255)),ct(this,ot,this.validateValue(s/255)),void 0!==i&&this.multiply(this.validateValue(i)),this}multiply(t){ct(this,at,this.validateValue(dt(this,at)*t)),ct(this,ht,this.validateValue(dt(this,ht)*t)),ct(this,ot,this.validateValue(dt(this,ot)*t)),ct(this,lt,this.validateValue(dt(this,lt)*t))}toArray(){return[dt(this,at),dt(this,ht),dt(this,ot),dt(this,lt)]}toString(){const t=Math.floor(255*dt(this,at)),e=Math.floor(255*dt(this,ht)),s=Math.floor(255*dt(this,ot));let i=t.toString(16);1===i.length&&(i="0"+i);let r=e.toString(16);1===r.length&&(r="0"+r);let n=s.toString(16);return 1===n.length&&(n="0"+n),`(${t} ${e} ${s}) ${dt(this,lt).toFixed(4)}, 0x${i}${r}${n}`}validateValue(t){return t<1/255?0:t>1?1:Math.floor(t/(1/255))*(1/255)}}at=new WeakMap,ht=new WeakMap,ot=new WeakMap,lt=new WeakMap;const pt={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};Object.freeze(pt);class wt{constructor(t,e,s){this.program=K(t.gl,e,s),Object.defineProperty(this,"program",{writable:!1})}}var ft,gt,yt,mt,vt=function(t,e,s){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,s),s},Et=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};class xt{constructor(t){ft.set(this,void 0),gt.set(this,void 0),yt.set(this,void 0),mt.set(this,void 0),this.gl=t,this.extensions={ANGLE_instanced_arrays:this.gl.getExtension("ANGLE_instanced_arrays")},vt(this,ft,null),vt(this,gt,-1),vt(this,yt,-1),vt(this,mt,-1),function(t){t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),t.clearDepth(1),t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL)}(this.gl),Object.defineProperty(this,"gl",{writable:!1}),Object.defineProperty(this,"extensions",{writable:!1})}get drawWidth(){return Et(this,gt)}get drawHeight(){return Et(this,yt)}get scale(){return Et(this,mt)}get isLandscape(){return Et(this,gt)>=Et(this,yt)}setCanvasDimensions(t,e){return this.gl.canvas.width=t,this.gl.canvas.height=e,this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height),Et(this,gt)<0&&this.setResolution(t,e),this}setResolution(t,e){return vt(this,gt,Math.max(0,t)),vt(this,yt,Math.max(0,e)),this.isLandscape?(vt(this,mt,this.gl.canvas.height/Et(this,yt)),Et(this,gt)*Et(this,mt)>this.gl.canvas.width&&vt(this,mt,this.gl.canvas.width/Et(this,gt))):(vt(this,mt,this.gl.canvas.width/Et(this,gt)),Et(this,yt)*Et(this,mt)>this.gl.canvas.height&&vt(this,mt,this.gl.canvas.width/Et(this,gt))),this}clear(t){var e,s,i,r,n;e=this.gl,s=t.r,i=t.g,r=t.b,n=t.a,e.clearColor(s,i,r,n),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)}begin(t){return vt(this,ft,t.program),this.gl.useProgram(Et(this,ft)),this}setVertexBuffer(...t){if(null===Et(this,ft))throw new Error("'begin(effect)' must be called before setting a VertexBuffer.");for(let e=0;e<t.length;e++){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t[e].buffer);for(let s of t[e].attributeSchema.elements){const i=this.gl.getAttribLocation(Et(this,ft),s.name);if(i<0)throw new Error(`The current program does not have a(n) '${s.name}' attribute.`);this.gl.enableVertexAttribArray(i),this.gl.vertexAttribPointer(i,s.size,s.type,!1,s.stride,s.offset),this.extensions.ANGLE_instanced_arrays.vertexAttribDivisorANGLE(i,t[e].instanceFrequency)}}return this}setIndexBuffer(t){return this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,t.buffer),this}setUniform(t,e){if(null===Et(this,ft))throw new Error("'begin(effect)' must be called before setting a uniform.");const s=this.gl.getUniformLocation(Et(this,ft),t);return this.gl.uniformMatrix4fv(s,!1,e),this}setUniform2(t){if(null===Et(this,ft))throw new Error("'begin(effect)' must be called before setting a NULL.");const e=this.gl.getUniformLocation(Et(this,ft),t);return this.gl.uniform1i(e,0),this}setTexture(t){return this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,t),this}drawArrays(t,e,s){return this.gl.drawArrays(t,e,s),this}drawElements(t,e,s){return this.gl.drawElements(t,3*e,this.gl.UNSIGNED_SHORT,s),this}drawInstancedElements(t,e,s,i){return this.extensions.ANGLE_instanced_arrays.drawElementsInstancedANGLE(t,3*e,this.gl.UNSIGNED_SHORT,s,i),this}disableVertexBuffer(...t){if(null===Et(this,ft))throw new Error("'begin(effect)' must be called before deleting a Buffer.");for(let e=0;e<t.length;e++)for(let s of t[e].attributeSchema.elements){const t=this.gl.getAttribLocation(Et(this,ft),s.name);if(t<0)throw new Error(`The current program does not have a(n) '${s.name}' attribute.`);this.gl.disableVertexAttribArray(t)}return this}end(){vt(this,ft,null)}}ft=new WeakMap,gt=new WeakMap,yt=new WeakMap,mt=new WeakMap;class bt extends nt{constructor(t,e){var s,i;super(t,e,et.INDEX),this.data=new Int16Array(this.length),this.buffer=(s=t.gl,i=this.data.byteLength,Z(s,s.ELEMENT_ARRAY_BUFFER,i,s.STATIC_DRAW))}}class Tt{constructor(t,e){this.vertices=t,this.indices=e,this.totalVertices=t.length/3,this.totalIndices=e.length,Object.defineProperty(this,"vertices",{writable:!1}),Object.defineProperty(this,"indices",{writable:!1}),Object.defineProperty(this,"totalVertices",{writable:!1}),Object.defineProperty(this,"totalIndices",{writable:!1})}}var Mt,_t,kt,At=function(t,e,s){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,s),s},St=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};class Pt{constructor(t,e){Mt.set(this,void 0),_t.set(this,void 0),kt.set(this,void 0),At(this,Mt,0),At(this,_t,0),At(this,kt,null),void 0!==t&&At(this,Mt,t),void 0!==e&&At(this,_t,e)}get width(){return St(this,Mt)}get height(){return St(this,_t)}get data(){return St(this,kt)}setPixels(t,e){At(this,kt,function(t,e,s,i){const r=t.createTexture();if(null===r)throw new Error("Something went wrong; could not create WebGLTexture.");return t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e,s,0,t.RGBA,t.UNSIGNED_BYTE,i),tt(e)&&tt(s)?t.generateMipmap(t.TEXTURE_2D):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST)),r}(t.gl,St(this,Mt),this.height,e))}static async fromURL(t,e){const s=await async function(t){return new Promise((e,s)=>{try{const s=new Image;s.onload=()=>{e(s)},s.src=t}catch(t){s(t)}})}(e),i=function(t,e){const s=t.createTexture();if(null===s)throw new Error("Something went wrong; could not create WebGLTexture.");return t.bindTexture(t.TEXTURE_2D,s),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),tt(e.width)&&tt(e.height)?t.generateMipmap(t.TEXTURE_2D):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST)),s}(t.gl,s),r=new Pt(s.width,s.height);return At(r,kt,i),r}}Mt=new WeakMap,_t=new WeakMap,kt=new WeakMap;class Wt extends nt{constructor(t,e,s,i,r){var n,a,h;super(t,s,et.VERTEX),this.attributeSchema=e,this.vertexUsage=i,this.instanceFrequency=r||0,this.data=new Float32Array(this.length),this.buffer=(n=t.gl,a=this.data.byteLength,h=this.vertexUsage,Z(n,n.ARRAY_BUFFER,a,h)),Object.defineProperty(this,"attributeSchema",{writable:!1}),Object.defineProperty(this,"vertexUsage",{writable:!1}),Object.defineProperty(this,"instanceFrequency",{writable:!1})}}const Rt={STREAM:35040,STATIC:35044,DYNAMIC:35048};Object.freeze(Rt);class Ot{constructor(t){this.gamepad=t,Object.defineProperty(this,"gamepad",{writable:!1})}}const Lt=new Map,It=new Map;function zt(t,e){const s=t.toLocaleLowerCase().split(",");for(let t=0;t<s.length;t++){const i=s[t].trim();if(It.has(i)){const t=It.get(i);if(e.gamepad.buttons[t].pressed&&e.gamepad.buttons[t].value>0)return!0}}return!1}It.set("a",0),It.set("b",1),It.set("x",2),It.set("y",3),It.set("leftbumper",4),It.set("rightbumper",5),It.set("lefttrigger",6),It.set("righttrigger",7),It.set("back",8),It.set("start",9),It.set("leftstick",10),It.set("rightstick",11),It.set("dpadup",12),It.set("dpaddown",13),It.set("dpadleft",14),It.set("dpadright",15),window.addEventListener("gamepadconnected",t=>{Lt.set(t.gamepad.index,t.gamepad)}),window.addEventListener("gamepaddisconnected",t=>{Lt.delete(t.gamepad.index)});class Nt{constructor(t,e){this.event=t,this.keysPressed=new Set(e),Object.defineProperty(this,"event",{writable:!1}),Object.defineProperty(this,"keysPressed",{writable:!1})}}const Bt=new Set;let Dt=null;function Gt(t,e){const s=t.toLocaleLowerCase().split(",");for(let t=0;t<s.length;t++)if(e.keysPressed.has(s[t].trim()))return!0;return!1}window.addEventListener("keydown",t=>{Dt=t,t.repeat||Bt.add(t.key.toLocaleLowerCase())}),window.addEventListener("keyup",t=>{Dt=t,Bt.delete(t.key.toLocaleLowerCase())}),window.addEventListener("blur",()=>{Dt=null,Bt.clear()});var Ut,Ct,jt=function(t,e,s){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,s),s},Ft=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};class Vt{constructor(){Ut.set(this,void 0),Ct.set(this,void 0),jt(this,Ut,null),jt(this,Ct,null)}pressed(t){return null!==Ft(this,Ut)&&null!==Ft(this,Ct)&&(!Gt(t,Ft(this,Ut))&&Gt(t,Ft(this,Ct)))}pressing(t){return null!==Ft(this,Ct)&&Gt(t,Ft(this,Ct))}update(){jt(this,Ut,Ft(this,Ct)),jt(this,Ct,null===Dt?null:new Nt(Dt,Bt))}}Ut=new WeakMap,Ct=new WeakMap;var Xt,$t,qt=function(t,e,s){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,s),s},Ht=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};class Yt{constructor(t){Xt.set(this,void 0),$t.set(this,void 0),this.playerIndex=t,qt(this,Xt,null),qt(this,$t,null),Object.defineProperty(this,"playerIndex",{writable:!1})}get connected(){return null!==Ht(this,$t)}get description(){return null===Ht(this,$t)?"":Ht(this,$t).gamepad.id}get leftStickAxes(){return null===Ht(this,$t)?{x:0,y:0}:{x:Ht(this,$t).gamepad.axes[0],y:-Ht(this,$t).gamepad.axes[1]}}get rightStickAxes(){return null===Ht(this,$t)?{x:0,y:0}:{x:Ht(this,$t).gamepad.axes[2],y:-Ht(this,$t).gamepad.axes[3]}}get buttons(){return null===Ht(this,$t)?[]:Ht(this,$t).gamepad.axes}pressed(t){return null!==Ht(this,Xt)&&null!==Ht(this,$t)&&(!zt(t,Ht(this,Xt))&&zt(t,Ht(this,$t)))}pressing(t){return null!==Ht(this,$t)&&zt(t,Ht(this,$t))}update(){var t;qt(this,Xt,Ht(this,$t)),qt(this,$t,(t=this.playerIndex,Lt.has(t)?new Ot(Lt.get(t)):null))}}Xt=new WeakMap,$t=new WeakMap;class Kt{constructor(t){this.event=t,Object.defineProperty(this,"event",{writable:!1})}}let Zt=null;function Qt(t,e){const s=t.toLocaleLowerCase().split(","),i=new Set(s);let r=0;for(let t of i)switch(t.trim()){case"leftclick":r+=1;break;case"rightclick":r+=2;break;case"middleclick":r+=4}return 0!=(e.event.buttons&r)}window.addEventListener("pointermove",t=>{Zt=t}),window.addEventListener("pointerdown",t=>{Zt=t}),window.addEventListener("pointerup",t=>{Zt=t}),window.addEventListener("blur",()=>{Zt=null});var Jt,te,ee,se,ie,re=function(t,e,s){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,s),s},ne=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};class ae{constructor(){Jt.set(this,void 0),te.set(this,void 0),ee.set(this,void 0),se.set(this,void 0),ie.set(this,void 0),re(this,Jt,null),re(this,te,null),re(this,ee,null),re(this,se,0),re(this,ie,0)}get x(){return ne(this,se)}get y(){return ne(this,ie)}attachElement(t){re(this,Jt,t)}pressed(t){return null!==ne(this,te)&&null!==ne(this,ee)&&(!Qt(t,ne(this,te))&&Qt(t,ne(this,ee)))}pressing(t){return null!==ne(this,ee)&&Qt(t,ne(this,ee))}update(){re(this,te,ne(this,ee)),re(this,ee,null===Zt?null:new Kt(Zt)),null!==ne(this,Jt)&&null!==ne(this,ee)&&(re(this,se,ne(this,ee).event.clientX-ne(this,Jt).offsetLeft),re(this,ie,ne(this,ee).event.clientY-ne(this,Jt).offsetTop))}}Jt=new WeakMap,te=new WeakMap,ee=new WeakMap,se=new WeakMap,ie=new WeakMap;var he,oe,le,ce,de,ue=function(t,e,s){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,s),s},pe=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};he=new WeakMap,oe=new WeakMap,le=new WeakMap,ce=new WeakMap,de=new WeakMap;var we,fe,ge,ye=function(t,e,s){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,s),s},me=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};class ve{constructor(t,e,s,i){we.set(this,void 0),fe.set(this,void 0),ge.set(this,void 0),this.name=t,ye(this,we,""),ye(this,fe,""),ye(this,ge,""),void 0!==e&&ye(this,we,e),void 0!==s&&ye(this,fe,s),void 0!==i&&ye(this,ge,i),Object.defineProperty(this,"name",{writable:!1})}get keys(){return me(this,we)}get gamepadButtons(){return me(this,fe)}get mouseButtons(){return me(this,ge)}remapKeys(t){ye(this,we,t)}remapGamepadButtons(t){ye(this,fe,t)}remapMouseButtons(t){ye(this,ge,t)}}we=new WeakMap,fe=new WeakMap,ge=new WeakMap;var Ee,xe=function(t,e,s){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,s),s},be=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};function Te(t){return t.toLocaleLowerCase()}Ee=new WeakMap;const Me=function(){const t=!!window.opr&&!!opr.addons||!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,e="undefined"!=typeof InstallTrigger,s=/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window.safari||"undefined"!=typeof safari&&safari.pushNotification).toString(),i=/*@cc_on!@*/!!document.documentMode,r=!i&&!!window.StyleMedia,n=!(!window.chrome||!window.chrome.webstore&&!window.chrome.runtime&&!window.chrome.csi),a=n&&-1!=navigator.userAgent.indexOf("Edg"),h=(n||t)&&!!window.CSS;let o="";return o=t?"opera":o,o=e?"firefox":o,o=s?"safari":o,o=i?"ie":o,o=r?"edge":o,o=n?"chrome":o,o=a?"edgechromium":o,{browserName:o,isBlink:h}}().isBlink;var _e,ke=function(t,e,s){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,s),s},Ae=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};function Se(t){return t.toLocaleLowerCase()}class Pe{constructor(){_e.set(this,void 0),ke(this,_e,new Map)}get length(){return Ae(this,_e).entries.length}get entries(){return Ae(this,_e).entries}register(t,e){const s=Se(t);if(Ae(this,_e).has(s))throw new TypeError("An entry with that name already exists; try a different name.");Ae(this,_e).set(s,e)}get(t){const e=Se(t);if(!Ae(this,_e).has(e))throw new TypeError("An entry with that name has not been registered.");return Ae(this,_e).get(e)}remove(t){const e=Se(t);if(!Ae(this,_e).has(e))throw new TypeError("An entry with that name has not been registered.");Ae(this,_e).delete(e)}}_e=new WeakMap;var We,Re,Oe,Le,Ie=function(t,e,s){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,s),s},ze=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};class Ne{constructor(t){if(We.set(this,void 0),Re.set(this,void 0),Oe.set(this,void 0),Le.set(this,void 0),t<0)throw new TypeError("The range must be greater than or equal to zero.");Ie(this,Oe,t),Ie(this,Le,0),Ie(this,Re,new Array(ze(this,Oe)).fill(0)),Ie(this,We,new Array(ze(this,Oe)).fill(0))}get size(){return ze(this,Le)}get values(){return function*(t){for(let e=0;e<t.length;e++)yield t[e]}(ze(this,We).slice(0,ze(this,Le)))}has(t){if(t<0)throw new TypeError("The 'value' parameter must be a positive number.");return t<ze(this,Oe)&&ze(this,Re)[t]<ze(this,Le)&&ze(this,We)[ze(this,Re)[t]]===t}add(t){if(t>=ze(this,Oe))throw new TypeError("The 'value' parameter cannot be greater than or equal to the SparseSet's range.");return!this.has(t)&&(ze(this,We)[ze(this,Le)]=t,ze(this,Re)[t]=ze(this,Le),Ie(this,Le,+ze(this,Le)+1),!0)}delete(t){if(!this.has(t))return!1;Ie(this,Le,+ze(this,Le)-1);for(let e=ze(this,We).indexOf(t);e<ze(this,Le);e++)ze(this,We)[e]=ze(this,We)[e+1],ze(this,Re)[ze(this,We)[e+1]]=e;return!0}clear(){Ie(this,Le,0)}*[(We=new WeakMap,Re=new WeakMap,Oe=new WeakMap,Le=new WeakMap,Symbol.iterator)](){for(let t=0;t<ze(this,Le);t++)yield ze(this,We)[t]}}var Be,De,Ge,Ue=function(t,e,s){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,s),s},Ce=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};class je{constructor(){Be.set(this,void 0),De.set(this,void 0),Ge.set(this,void 0),this.scenes=new Pe,Ue(this,Be,!1),Ue(this,De,null),Ue(this,Ge,null),Object.defineProperty(this,"scenes",{writable:!1}),Object.defineProperty(this,"graphics",{writable:!1})}register(...t){for(let e=0;e<t.length;e++)this.scenes.register(t[e].name,t[e]);return this}queue(t){const e=this.scenes.get(t);if(void 0===e)throw new Error("Something went wrong!");Ue(this,Ge,e),Ue(this,Be,!0)}update(t){var e;this.updateTransitions(),null===(e=Ce(this,De))||void 0===e||e.update(t)}draw(t,e){var s;null===(s=Ce(this,De))||void 0===s||s.draw(t,e)}updateTransitions(){var t,e;Ce(this,Be)&&(null===(t=Ce(this,De))||void 0===t||t.onExit(),null===(e=Ce(this,Ge))||void 0===e||e.onEnter(),Ue(this,De,Ce(this,Ge)),Ue(this,Be,!1))}}Be=new WeakMap,De=new WeakMap,Ge=new WeakMap;const Fe=new Tt([0,0,0,1,0,0,1,-1,0,0,-1,0],[0,3,1,1,3,2]),Ve=function(){const t=Math.sqrt(3)/2;return new Tt([1-t,0,0,1,-.5,0,1-t,-1,0],[0,2,1])}(),Xe=function(t){if(t<=2)throw new TypeError("A polygon must have at least 3 vertices.");const e=2*Math.PI,s=[],i=[],r=3*(t-2),n=e/t;for(let i=e;i>=0&&(s.push(.5+.5*Math.cos(i)),s.push(.5*Math.sin(i)-.5),s.push(0),!(s.length>=3*t));i-=n);let a=1;for(let t=0;t<r;t+=3)i.push(0),i.push(a+1),i.push(a),a++;return new Tt(s,i)}(90);const $e=new Y([new $("a_vertexPosition",3,q.FLOAT)]);class qe{constructor(t,e){this.vertexBuffer=new Wt(t,$e,e.vertices.length,Rt.STATIC),this.indexBuffer=new bt(t,e.indices.length),this.totalVertices=e.totalVertices,this.totalTriangles=e.totalIndices/3,this.vertexBuffer.setData(e.vertices),this.indexBuffer.setData(e.indices),Object.defineProperty(this,"vertexBuffer",{writable:!1}),Object.defineProperty(this,"indexBuffer",{writable:!1}),Object.defineProperty(this,"totalVertices",{writable:!1}),Object.defineProperty(this,"totalTriangles",{writable:!1})}}var He,Ye,Ke=function(t,e,s){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,s),s},Ze=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};class Qe{constructor(t){He.set(this,void 0),Ye.set(this,void 0),Ke(this,He,t),Ke(this,Ye,new Pe),this.createDefaults()}registerGeometry(t,e){return Ze(this,Ye).register(t,e),this}getGeometry(t){return Ze(this,Ye).get(t)}removeGeometry(t){return Ze(this,Ye).remove(t),this}createDefaults(){this.registerGeometry("Susurrus_Circle",new qe(Ze(this,He),Xe)),this.registerGeometry("Susurrus_Square",new qe(Ze(this,He),Fe)),this.registerGeometry("Susurrus_Triangle",new qe(Ze(this,He),Ve))}}He=new WeakMap,Ye=new WeakMap;var Je,ts,es,ss,is,rs,ns,as,hs,os,ls,cs,ds,us,ps,ws,fs=function(t,e,s){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,s),s},gs=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};const ys=new Y([new $("a_translation",3,q.FLOAT),new $("a_scale",3,q.FLOAT),new $("a_rotationOffset",3,q.FLOAT),new $("a_rotation",1,q.FLOAT),new $("a_color",4,q.FLOAT)]);class ms{constructor(t,e,s,i,r){Je.set(this,void 0),ts.set(this,void 0),es.set(this,void 0),ss.set(this,void 0),is.set(this,void 0),rs.set(this,void 0),ns.set(this,void 0),as.set(this,void 0),hs.set(this,void 0),os.set(this,void 0),ls.set(this,void 0),cs.set(this,void 0),ds.set(this,void 0),us.set(this,void 0),ps.set(this,void 0),ws.set(this,void 0),fs(this,Je,t),fs(this,es,null),fs(this,ts,null),fs(this,is,e),fs(this,rs,s),fs(this,ns,0),fs(this,as,i),fs(this,hs,r),fs(this,os,new m(0,0,0)),fs(this,ls,new m(1,1,1)),fs(this,cs,new m(0,0,0)),fs(this,ds,0),fs(this,us,new ut(16777215)),fs(this,ps,!1),fs(this,ws,!1),fs(this,ss,null)}get x(){return gs(this,is)}set x(t){t!==gs(this,is)&&(fs(this,is,t),fs(this,ws,!0))}get y(){return gs(this,rs)}set y(t){t!==gs(this,rs)&&(fs(this,rs,t),fs(this,ws,!0))}get z(){return gs(this,ns)}set z(t){t!==gs(this,ns)&&(fs(this,ns,t),fs(this,ws,!0))}get width(){return gs(this,as)}set width(t){t!==gs(this,as)&&(fs(this,as,t),fs(this,ws,!0))}get height(){return gs(this,hs)}set height(t){t!==gs(this,hs)&&(fs(this,hs,t),fs(this,ws,!0))}get translation(){return gs(this,os)}set translation(t){t!==gs(this,os)&&(fs(this,os,t),fs(this,ws,!0))}get scale(){return gs(this,ls)}set scale(t){t!==gs(this,ls)&&(fs(this,ls,t),fs(this,ws,!0))}get rotationOffset(){return gs(this,cs)}set rotationOffset(t){t!==gs(this,cs)&&(fs(this,cs,t),fs(this,ws,!0))}get rotation(){return gs(this,ds)}set rotation(t){t!==gs(this,ds)&&(fs(this,ds,t),fs(this,ws,!0))}get color(){return gs(this,us)}set color(t){t!==gs(this,us)&&(fs(this,us,t),fs(this,ws,!0))}get position(){return new m(gs(this,is),gs(this,rs),gs(this,ns))}get aabb(){return new h(gs(this,is),gs(this,rs),gs(this,as),gs(this,hs))}setPosition(t,e,s){return fs(this,is,t),fs(this,rs,e),fs(this,ns,s),fs(this,ws,!0),this}attachMesh(t){return fs(this,Je,t),fs(this,ps,!0),this}attachGeometry(t){return fs(this,es,t),this}attachEffect(t){return fs(this,ss,t),this}createGeometry(t){return fs(this,es,new qe(t,gs(this,Je))),this}createModelBuffer(t){fs(this,ps,!1);let e=ys.size;return Me&&(e*=gs(this,Je).totalVertices),fs(this,ts,new Wt(t,ys,e,Rt.DYNAMIC,1)),this.updateModelBuffer(),this}calculateTransform(){const t=M.createScale(this.width*this.scale.x,this.height*this.scale.y,this.scale.z),e=M.createTranslation(-this.rotationOffset.x,-this.rotationOffset.y,0),s=M.createRotationZ(this.rotation),i=M.createTranslation(this.x+this.translation.x+this.rotationOffset.x,this.y+this.translation.y+this.rotationOffset.y,this.translation.z),r=M.multiply;return r(r(r(t,e),s),i)}applyChanges(){if(null===gs(this,ts))throw new TypeError("A model has not been created; cannot apply changes.");fs(this,ws,!1),this.updateModelBuffer()}draw(t,e){if(null!==gs(this,es)&&null!==gs(this,ts)&&null!==gs(this,ss)){if(gs(this,ps))throw new TypeError("The polygon's mesh was modified, but a new model was not created. Make sure to call createModel(graphics).");if(gs(this,ws))throw new TypeError("The polygon's transform was modified, but applyChanges() was never called.");t.begin(gs(this,ss)).setVertexBuffer(gs(this,es).vertexBuffer,gs(this,ts)).setIndexBuffer(gs(this,es).indexBuffer).setUniform("worldViewProjection",e.wvp.data).drawElements(pt.TRIANGLES,gs(this,es).totalTriangles,0).end()}}updateModelBuffer(){if(null===gs(this,ts))return;let t=[];t=t.concat(new m(gs(this,is)+this.translation.x,gs(this,rs)+this.translation.y,gs(this,ns)+this.translation.z).toArray()),t=t.concat(new m(gs(this,as)*gs(this,ls).x,gs(this,hs)*gs(this,ls).y,gs(this,ls).z).toArray()),t=t.concat(gs(this,cs).toArray()),t=t.concat(gs(this,ds)),t=t.concat(gs(this,us).toArray()),gs(this,ts).setData(t)}}Je=new WeakMap,ts=new WeakMap,es=new WeakMap,ss=new WeakMap,is=new WeakMap,rs=new WeakMap,ns=new WeakMap,as=new WeakMap,hs=new WeakMap,os=new WeakMap,ls=new WeakMap,cs=new WeakMap,ds=new WeakMap,us=new WeakMap,ps=new WeakMap,ws=new WeakMap;class vs extends ms{constructor(t,e,s,i){super(Fe,t,e,s,i)}}class Es extends ms{constructor(t,e,s){super(Xe,t,e,2*s,2*s),this.radius=s}}const xs={VERTEX:"\n\t\tuniform mat4 worldViewProjection;\n\n\t\tattribute vec3 a_vertexPosition;\n\t\tattribute vec3 a_translation;\n\t\tattribute vec3 a_scale;\n\t\tattribute vec3 a_rotationOffset;\n\t\tattribute float a_rotation;\n\t\tattribute vec4 a_color;\n\n\t\tvarying lowp vec4 v_color;\n\n\t\tmat4 createTranslation(vec3 translation) {\n\t\t\treturn mat4(\n\t\t\t\t1, 0, 0, 0,\n\t\t\t\t0, 1, 0, 0,\n\t\t\t\t0, 0, 1, 0,\n\t\t\t\ttranslation.x, translation.y, translation.z, 1\n\t\t\t);\n\t\t}\n\n\t\tmat4 createScale(vec3 scale) {\n\t\t\treturn mat4(\n\t\t\t\tscale.x, 0, 0, 0,\n\t\t\t\t0, scale.y, 0, 0,\n\t\t\t\t0, 0, scale.z, 0,\n\t\t\t\t0, 0, 0, 1\n\t\t\t);\n\t\t}\n\n\t\tmat4 createRotationZ(float theta) {\n\t\t\treturn mat4(\n\t\t\t\tcos(theta), -sin(theta), 0, 0,\n\t\t\t\tsin(theta), cos(theta), 0, 0,\n\t\t\t\t0, 0, 1, 0,\n\t\t\t\t0, 0, 0, 1\n\t\t\t);\n\t\t}\n\n\t\tvoid main() {\n\t\t\tmat4 model = createTranslation(a_translation - a_rotationOffset) * createRotationZ(a_rotation) * createTranslation(a_rotationOffset) * createScale(a_scale);\n\t\t\tgl_Position = worldViewProjection * model * vec4(a_vertexPosition, 1);\n\n\t\t\tv_color = a_color;\n\t\t}\n\t",FRAGMENT:"\n\t\tvarying lowp vec4 v_color;\n\n\t\tvoid main() {\n\t\t\tgl_FragColor = v_color;\n\t\t}\n\t"};Object.freeze(xs);class bs extends wt{constructor(t){super(t,xs.VERTEX,xs.FRAGMENT)}}var Ts,Ms,_s,ks=function(t,e,s){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,s),s},As=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};class Ss{constructor(t){Ts.set(this,void 0),Ms.set(this,void 0),_s.set(this,void 0),ks(this,Ts,t),ks(this,Ms,null),ks(this,_s,null)}attachGraphics(t){ks(this,Ms,t),ks(this,_s,new bs(As(this,Ms)))}createCircle(t,e,s){if(null===As(this,Ms))throw new TypeError("A GraphicsManager has not been attached; cannot create geometry. Make sure to call 'attachGraphics(graphics)' before using a Factory.");if(null===As(this,_s))throw new Error("Something unexpected happen! Could not create shared PolygonEffect.");if(null===As(this,Ts).geometryManager)throw new Error("Something unexpected happen! The Theater's GeometryManager was not initialized.");const i=As(this,Ts).geometryManager.getGeometry("Susurrus_Circle");if(void 0===i)throw new Error("Could not find geometry.");return new Es(t,e,s).attachEffect(As(this,_s)).attachGeometry(i).createModelBuffer(As(this,Ms))}createQuad(t,e,s,i){if(null===As(this,Ms))throw new TypeError("A GraphicsManager has not been attached; cannot create geometry. Make sure to call 'attachGraphics(graphics)' before using a Factory.");if(null===As(this,_s))throw new Error("Something unexpected happen! Could not create shared PolygonEffect.");if(null===As(this,Ts).geometryManager)throw new Error("Something unexpected happen! The Theater's GeometryManager was not initialized.");const r=As(this,Ts).geometryManager.getGeometry("Susurrus_Square");if(void 0===r)throw new Error("Could not find geometry.");return new vs(t,e,s,i).attachEffect(As(this,_s)).attachGeometry(r).createModelBuffer(As(this,Ms))}}Ts=new WeakMap,Ms=new WeakMap,_s=new WeakMap;var Ps,Ws,Rs,Os,Ls,Is,zs,Ns,Bs=function(t,e,s){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,s),s},Ds=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};Ps=new WeakMap,Ws=new WeakMap,Rs=new WeakMap,Os=new WeakMap,Ls=new WeakMap,Is=new WeakMap,zs=new WeakMap,Ns=new WeakMap;const Gs={BLACK:new ut(0),WHITE:new ut(16777215),RED:new ut(16711680),GREEN:new ut(65280),BLUE:new ut(255)};Object.freeze(Gs);const Us={SKY_BLUE:new ut(2731519)};Object.freeze(Us);var Cs,js,Fs,Vs,Xs,$s=Object.freeze({__proto__:null,BASIC:Gs,PICO8:Us}),qs=function(t,e,s){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,s),s},Hs=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};const Ys=new Y([new $("a_textureCoord",2,q.FLOAT)]),Ks=new Y([new $("a_scale",3,q.FLOAT)]);Cs=new WeakMap,js=new WeakMap,Fs=new WeakMap,Vs=new WeakMap,Xs=new WeakMap;const Zs={VERTEX:"\n\t\tuniform mat4 worldViewProjection;\n\n\t\tattribute vec3 a_vertexPosition;\n\t\tattribute vec2 a_textureCoord;\n\t\tattribute vec3 a_scale;\n\n\t\tvarying highp vec2 v_textureCoord;\n\n\t\tmat4 createScale(vec3 scale) {\n\t\t\treturn mat4(\n\t\t\t\t\tscale.x, 0, 0, 0,\n\t\t\t\t\t0, scale.y, 0, 0,\n\t\t\t\t\t0, 0, scale.z, 0,\n\t\t\t\t\t0, 0, 0, 1\n\t\t\t);\n\t\t}\n\n\t\tvoid main() {\n\t\t\tmat4 model = createScale(a_scale);\n\t\t\tgl_Position = worldViewProjection * model * vec4(a_vertexPosition, 1);\n\n\t\t\tv_textureCoord = a_textureCoord;\n\t\t}\n\t\t",FRAGMENT:"\n\t\tuniform sampler2D sampler;\n\n\t\tvarying highp vec2 v_textureCoord;\n\n\t\tvoid main() {\n\t\t\tgl_FragColor = texture2D(sampler, v_textureCoord);\n\t\t}\n    "};Object.freeze(Zs);class Qs{constructor(t){this.boundary=t}addRange(t){for(let e=0;e<t.length;e++)this.add(t[e])}}var Js,ti,ei,si,ii,ri,ni=function(t,e,s){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,s),s},ai=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};function hi(t,e){let s=t.x,i=t.y;return s=Math.max(e.left,s),s=Math.min(e.right,s),i=Math.max(e.bottom,i),i=Math.min(e.top,i),{x:s,y:i}}Js=new WeakMap,ti=new WeakMap,ei=new WeakMap,si=new WeakMap,ii=new WeakMap,ri=new WeakMap;var oi,li,ci,di,ui,pi,wi,fi,gi=function(t,e,s){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,s),s},yi=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};class mi extends Qs{constructor(t,e){super(t),oi.set(this,void 0),li.set(this,void 0),ci.set(this,void 0),di.set(this,void 0),ui.set(this,void 0),pi.set(this,void 0),wi.set(this,void 0),fi.set(this,void 0),gi(this,oi,e),gi(this,li,!1),gi(this,ci,0),gi(this,di,new Array(yi(this,oi)).fill(null)),gi(this,ui,null),gi(this,pi,null),gi(this,wi,null),gi(this,fi,null)}query(t){const e=[];if(this.boundary.completelyWithin(t))for(let t=0;t<yi(this,di).length;t++)null!==yi(this,di)[t]&&e.push(yi(this,di)[t].identifier);else for(let s=0;s<yi(this,di).length;s++)null!==yi(this,di)[s]&&t.intersects(yi(this,di)[s].boundary)&&e.push(yi(this,di)[s].identifier);return yi(this,li)?(e.push(...yi(this,ui).query(t)),e.push(...yi(this,pi).query(t)),e.push(...yi(this,wi).query(t)),e.push(...yi(this,fi).query(t)),e):e}add(t){var e;return!!t.boundary.intersects(this.boundary)&&(yi(this,ci)<yi(this,oi)?(yi(this,di)[(gi(this,ci,1+(e=+yi(this,ci))),e)]=t,!0):(yi(this,li)||this.subdivide(),!!(yi(this,ui).insert(t)||yi(this,pi).insert(t)||yi(this,wi).insert(t)||yi(this,fi).insert(t))))}clear(){yi(this,li)&&(yi(this,ui).clear(),yi(this,pi).clear(),yi(this,wi).clear(),yi(this,fi).clear(),gi(this,ui,null),gi(this,pi,null),gi(this,wi,null),gi(this,fi,null)),gi(this,li,!1),gi(this,ci,0),yi(this,di).fill(null)}subdivide(){const t=.5*this.boundary.width,e=.5*this.boundary.height;gi(this,ui,new mi(new h(this.boundary.x,this.boundary.y,t,e),yi(this,oi))),gi(this,pi,new mi(new h(this.boundary.x+t,this.boundary.y,t,e),yi(this,oi))),gi(this,wi,new mi(new h(this.boundary.x+t,this.boundary.y-e,t,e),yi(this,oi))),gi(this,fi,new mi(new h(this.boundary.x,this.boundary.y-e,t,e),yi(this,oi))),gi(this,li,!0)}}oi=new WeakMap,li=new WeakMap,ci=new WeakMap,di=new WeakMap,ui=new WeakMap,pi=new WeakMap,wi=new WeakMap,fi=new WeakMap,exports.AttributeElement=$,exports.AttributeSchema=Y,exports.AttributeType=q,exports.Bin=class extends Qs{constructor(t,e){super(t),Js.set(this,void 0),ti.set(this,void 0),ei.set(this,void 0),si.set(this,void 0),ii.set(this,void 0),ri.set(this,void 0),ni(this,Js,new h(s(this.boundary.x,this.boundary.left,this.boundary.right,0,this.boundary.width),s(this.boundary.y,this.boundary.bottom,this.boundary.top,0,this.boundary.height),this.boundary.width,this.boundary.height)),ni(this,ti,Math.ceil(Math.log2(e))),ni(this,ei,1<<ai(this,ti)),ni(this,si,Math.ceil(this.boundary.width/2**ai(this,ti))),ni(this,ii,Math.ceil(this.boundary.height/2**ai(this,ti))),ni(this,ri,new Array(ai(this,ii)*ai(this,si)).fill(null));for(let t=0;t<ai(this,ri).length;t++)ai(this,ri)[t]=new Set}query(t){const e=[];if(this.boundary.completelyWithin(t)){for(let t=0;t<ai(this,ri).length;t++)for(let s of ai(this,ri)[t])e.push(s);return e}const s=new Set,i=this.getHashIDs(t);for(let t of i)for(let i of ai(this,ri)[t])s.has(i)||(s.add(i),e.push(i));return e}add(t){if(!t.boundary.intersects(this.boundary))return!1;const e=this.getHashIDs(t.boundary);for(let s of e)ai(this,ri)[s].add(t.identifier);return e.size>0}clear(){for(let t=0;t<ai(this,ri).length;t++)ai(this,ri)[t].clear()}getHashIDs(t){const e=new h(s(t.x,this.boundary.left,this.boundary.right,0,this.boundary.width),s(t.y,this.boundary.bottom,this.boundary.top,0,this.boundary.height),t.width,t.height),i=function(t,e){const s=hi({x:t.x,y:t.y},e),i=Math.min(t.width,e.right-s.x),r=Math.min(t.height,s.y-e.bottom);return new h(s.x,s.y,i,r)}(e,ai(this,Js)),r=[this.getHash(i.left,i.top),this.getHash(i.right,i.top),this.getHash(i.right,i.bottom),this.getHash(i.left,i.bottom)];if(i.width>ai(this,ei)||i.height>ai(this,ei)){const t=Math.ceil(i.height/ai(this,ei)),s=Math.ceil(i.width/ai(this,ei));for(let i=0;i<=t;i++)for(let t=0;t<=s;t++)r.push(this.getHash(e.x+t*ai(this,ei),e.y-i*ai(this,ei)))}return new Set(r.filter(t=>t>=0))}getHash(t,e){const s=hi({x:t,y:e},ai(this,Js)),i=s.x>>ai(this,ti),r=s.y>>ai(this,ti);return r<0||r>=ai(this,si)||i<0||i>=ai(this,ii)?-1:ai(this,si)*r+i}},exports.Camera=class{constructor(){P.set(this,void 0),W.set(this,void 0),R.set(this,void 0),O.set(this,void 0),L.set(this,void 0),I.set(this,void 0),z.set(this,void 0),N.set(this,void 0),B.set(this,void 0),D.set(this,void 0),G.set(this,void 0),U.set(this,void 0),F(this,P,m.ZERO),F(this,W,new m(V(this,P).x,V(this,P).y,V(this,P).z+1)),F(this,R,m.UP),F(this,O,0),F(this,L,0),F(this,I,0),F(this,z,0),F(this,N,C.None),F(this,B,M.IDENTITY),F(this,D,M.createLookAt(V(this,W),V(this,P),V(this,R))),F(this,G,M.IDENTITY),F(this,U,M.IDENTITY)}get wvp(){return V(this,U)}get bounds(){return new h(V(this,W).x,V(this,W).y,V(this,I),V(this,z))}createOrthographic(t,e,s,i){return F(this,I,t),F(this,z,e),F(this,O,void 0===s?0:s),F(this,L,void 0===i?0:i),F(this,N,C.Orthographic),F(this,G,M.createOrthographic(V(this,I),V(this,z),V(this,O),V(this,L))),F(this,U,X(V(this,B),V(this,D),V(this,G))),this}createPerspective(t,e,s,i){return F(this,I,t),F(this,z,e),F(this,O,void 0===s?0:s),F(this,L,void 0===i?0:i),F(this,N,C.Perspective),F(this,G,M.createPerspective(V(this,I),V(this,z),V(this,O),V(this,L))),F(this,U,X(V(this,B),V(this,D),V(this,G))),this}setDimensions(t,e){switch(F(this,I,t),F(this,z,e),V(this,N)){case C.Orthographic:F(this,G,M.createOrthographic(V(this,I),V(this,z),V(this,O),V(this,L)));break;case C.Perspective:F(this,G,M.createPerspective(V(this,I),V(this,z),V(this,O),V(this,L)))}return F(this,U,X(V(this,B),V(this,D),V(this,G))),this}setPosition(t,e,s){return V(this,W).x=t,V(this,W).y=e,V(this,W).z=s,F(this,D,M.createLookAt(V(this,W),V(this,P),V(this,R))),F(this,U,X(V(this,B),V(this,D),V(this,G))),this}setTarget(t,e,s){return V(this,P).x=t,V(this,P).y=e,V(this,P).z=s,F(this,D,M.createLookAt(V(this,W),V(this,P),V(this,R))),F(this,U,X(V(this,B),V(this,D),V(this,G))),this}setUp(t,e,s){return V(this,R).x=t,V(this,R).y=e,V(this,R).z=s,F(this,D,M.createLookAt(V(this,W),V(this,P),V(this,R))),F(this,U,X(V(this,B),V(this,D),V(this,G))),this}setWorld(t){return F(this,B,t),F(this,U,X(V(this,B),V(this,D),V(this,G))),this}},exports.CollisionHelper=w,exports.Color=ut,exports.DrawMode=pt,exports.Effect=wt,exports.GeometryData=qe,exports.IndexBuffer=bt,exports.InputHandler=class{constructor(t,e){he.set(this,void 0),oe.set(this,void 0),le.set(this,void 0),ce.set(this,void 0),de.set(this,void 0),this.playerIndex=e,ue(this,he,new Vt),ue(this,oe,new ae),ue(this,le,new Yt(e)),ue(this,ce,null),ue(this,de,"keyboard"),pe(this,oe).attachElement(t),Object.defineProperty(this,"playerIndex",{writable:!1})}get lastInputType(){return pe(this,de)}get pointerPosition(){return{x:pe(this,oe).x,y:pe(this,oe).y}}loadProfile(t){return ue(this,ce,t),this}pressed(t){if(null===pe(this,ce))throw new TypeError("An input profile has not been loaded yet.");const e=pe(this,ce).getMapping(t);return void 0!==e&&(0===this.playerIndex&&(pe(this,he).pressed(e.keys)||pe(this,oe).pressed(e.mouseButtons))?(ue(this,de,"keyboard"),!0):!(!pe(this,le).connected||!pe(this,le).pressed(e.gamepadButtons))&&(ue(this,de,"gamepad"),!0))}pressing(t){if(null===pe(this,ce))throw new TypeError("An input profile has not been loaded yet.");const e=pe(this,ce).getMapping(t);return void 0!==e&&(0===this.playerIndex&&(pe(this,he).pressing(e.keys)||pe(this,oe).pressing(e.mouseButtons))?(ue(this,de,"keyboard"),!0):!(!pe(this,le).connected||!pe(this,le).pressing(e.gamepadButtons))&&(ue(this,de,"gamepad"),!0))}update(){pe(this,he).update(),pe(this,oe).update(),pe(this,le).update()}},exports.InputProfile=class{constructor(t){Ee.set(this,void 0),this.name=t,xe(this,Ee,new Map)}createMapping(t,e,s,i){const r=Te(t);if(be(this,Ee).has(r))throw new TypeError("An InputMapping with that name already exists; try a different name.");const n=new ve(r,e,s,i);return be(this,Ee).set(n.name,n),this}getMapping(t){const e=Te(t);if(!be(this,Ee).has(e))throw new TypeError("An InputMapping with that name has not been registered.");return be(this,Ee).get(e)}remapKeys(t,e){var s;null===(s=this.getMapping(t))||void 0===s||s.remapKeys(e)}remapGamepadButtons(t,e){var s;null===(s=this.getMapping(t))||void 0===s||s.remapGamepadButtons(e)}remapMouseButtons(t,e){var s;null===(s=this.getMapping(t))||void 0===s||s.remapMouseButtons(e)}removeMapping(t){const e=Te(t);if(!be(this,Ee).has(e))throw new TypeError("An InputMapping with that name has not been registered.");return be(this,Ee).delete(e),this}},exports.LineSegment=e,exports.MathExt=n,exports.Matrix=y,exports.Matrix4=M,exports.Mesh=Tt,exports.Palettes=$s,exports.Partitioner=Qs,exports.Polygon=ms,exports.PolygonEffect=bs,exports.Quad=vs,exports.Quadtree=mi,exports.Random=class{constructor(t){_.set(this,void 0),k(this,_,S(void 0!==t?Math.floor(t):Math.floor(Math.random()*Number.MAX_SAFE_INTEGER)))}next(){return A(this,_).call(this)}range(t,e){if(e<t)throw new TypeError("The 'maxValue' parameter must be greater than 'minValue' parameter.");return t+Math.floor(A(this,_).call(this)*(e-t))}},exports.RandomHelper=j,exports.Rectangle=h,exports.Scene=class{constructor(t,e){this.name=t,this.theater=e,Object.defineProperty(this,"name",{writable:!1}),Object.defineProperty(this,"theater",{writable:!1})}onEnter(){}onExit(){}},exports.SparseSet=Ne,exports.Sprite=class{constructor(t){Cs.set(this,void 0),js.set(this,void 0),Fs.set(this,void 0),Vs.set(this,void 0),Xs.set(this,void 0),qs(this,Cs,t),qs(this,js,null),qs(this,Fs,null),qs(this,Vs,null),qs(this,Xs,null)}attachGeometry(t){return qs(this,js,t),this}attachEffect(t){return qs(this,Fs,t),this}createTextureBuffer(t){qs(this,Vs,new Wt(t,Ys,8,Rt.STATIC)),Hs(this,Vs).setData([0,0,1,0,1,1,0,1]);let e=Ks.size;return Me&&(e*=6),qs(this,Xs,new Wt(t,Ks,e,Rt.DYNAMIC,1)),Hs(this,Xs).setData([Hs(this,Cs).width,Hs(this,Cs).height,1]),this}draw(t,e){null!==Hs(this,Cs).data&&null!==Hs(this,js)&&null!==Hs(this,Fs)&&null!==Hs(this,Vs)&&null!==Hs(this,Xs)&&t.begin(Hs(this,Fs)).setVertexBuffer(Hs(this,js).vertexBuffer,Hs(this,Vs),Hs(this,Xs)).setIndexBuffer(Hs(this,js).indexBuffer).setUniform("worldViewProjection",e.wvp.data).setUniform2("sampler").setTexture(Hs(this,Cs).data).drawElements(pt.TRIANGLES,Hs(this,js).totalTriangles,0).end()}},exports.SpriteEffect=class extends wt{constructor(t){super(t,Zs.VERTEX,Zs.FRAGMENT)}},exports.Texture2D=Pt,exports.Theater=class{constructor(){Ps.set(this,void 0),Ws.set(this,void 0),Rs.set(this,void 0),Os.set(this,void 0),Ls.set(this,void 0),Is.set(this,void 0),zs.set(this,void 0),Ns.set(this,void 0),Bs(this,Ps,null),Bs(this,Ws,null),Bs(this,Rs,null),Bs(this,Os,null),this.smartKeyboard=new Vt,this.smartPointer=new ae,this.sceneManager=new je,this.factory=new Ss(this),this.loop=!0,Bs(this,Ls,!1),Bs(this,Is,!1),Bs(this,zs,0),Bs(this,Ns,[]),window.addEventListener("mousedown",t=>{null!==Ds(this,Ws)&&Bs(this,Is,t.target===Ds(this,Ws))}),Object.defineProperty(this,"smartKeyboard",{writable:!1}),Object.defineProperty(this,"smartPointer",{writable:!1}),Object.defineProperty(this,"sceneManager",{writable:!1}),Object.defineProperty(this,"factory",{writable:!1})}get parent(){return Ds(this,Ps)}get canvas(){return Ds(this,Ws)}get graphics(){return Ds(this,Rs)}get geometryManager(){return Ds(this,Os)}get inFocus(){return Ds(this,Is)}get totalElapsedTime(){return Ds(this,zs)}get args(){return Ds(this,Ns)}run(t){if(!Ds(this,Ls)){if(void 0!==t){const e=t.trim().split(" ");Bs(this,Ns,e)}this.initialize(),Bs(this,Ls,!0)}this.main(0)}setParent(t){const e=document.getElementById(t);if(null===e)throw new TypeError(`Could not find an element with an id of '${t}'.`);return Bs(this,Ps,e),this}createCanvas(t,e,s){if(null===Ds(this,Ps))throw new Error("A parent element does not exist; a canvas cannot be created. Make sure to call that 'setParent(id)' was called.");Bs(this,Ws,document.createElement("canvas")),Ds(this,Ws).id=t,Ds(this,Ws).width=e,Ds(this,Ws).height=s,Ds(this,Ps).appendChild(Ds(this,Ws)),Bs(this,Rs,new xt(function(t){const e=t.getContext("webgl");if(null===e)throw new Error("WebGL is not supported on this device.");return e}(Ds(this,Ws)))),Bs(this,Os,new Qe(Ds(this,Rs))),this.factory.attachGraphics(Ds(this,Rs)),this.smartPointer.attachElement(Ds(this,Ws))}initialize(){}update(t){this.sceneManager.update(t)}draw(t){if(null===Ds(this,Rs))throw new TypeError("The GraphicsManager has not been instantiated; cannot draw anything. Make sure to call appendCanvas() before rendering anything.");this.sceneManager.draw(Ds(this,Rs),t)}managedUpdate(t){this.smartKeyboard.update(),this.smartPointer.update()}main(t){let e=(t-Ds(this,zs))/1e3;Number.isNaN(e)&&(e=0),Bs(this,zs,t),this.managedUpdate(e),this.update(e),null!==this.graphics&&this.draw(e),this.loop&&window.requestAnimationFrame(t=>{this.main(t)})}},exports.Vector2=a,exports.Vector3=m,exports.VertexBuffer=Wt,exports.VertexUsage=Rt;
